<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE paymentService PUBLIC "-//WorldPay//DTD WorldPay PaymentService v1//EN"
        "http://dtd.worldpay.com/paymentService_v1.dtd">
<paymentService version="1.4" merchantCode="${merchantCode}">
    <submit>
        <order orderCode="${orderCode?xml}">
            <description>${description?xml}</description>
            <amount currencyCode="GBP" exponent="2" value="${amount}"/>
            <paymentDetails>
                <CARD-SSL>
                    <cardNumber>${cardNumber?xml}</cardNumber>
                    <expiryDate>
                        <date month="${expiryMonthTwoDigits?xml}" year="${expiryYearFourDigits?xml}"/>
                    </expiryDate>
                    <cardHolderName>${authCardDetails.cardHolder?xml}</cardHolderName>
                    <cvc>${cvc?xml}</cvc>
                    <#if address??>
                    <cardAddress>
                        <address>
                            <address1>${address.address1?xml}</address1>
                            <#if address.address2??>
                            <address2>${address.address2?xml}}</address2>
                            </#if>
                            <postalCode>${address.postalCode?xml}}</postalCode>
                            <city>${address.city?xml}</city>
                            <#if address.state??>
                            <state>${address.state?xml}</state>
                            </#if>
                            <countryCode>${address.countryCode?xml}</countryCode>
                        </address>
                    </cardAddress>
                    </#if>
                </CARD-SSL>
                <#if storesTokenisedCredentials()>
                <#if customerInitiatedReason??>
                <storedCredentials usage="FIRST" customerInitiatedReason="${customerInitiatedReason?xml}"/>
                <#else>
                <storedCredentials usage="FIRST"/>
                </#if>
                </#if>
                <#if sessionId??>
                <#if ipAddress??>
                <session id="${sessionId?xml}" shopperIPAddress="${ipAddress?xml}"/>
                <#else>
                <session id="${sessionId?xml}"/>
                </#if>
                </#if>
            </paymentDetails>
            <#if acceptHeader?? || userAgentHeader?? || browserLanguageTag?? || email?? || authenticatedShopperId??>
            <shopper>
                <#if email??>
                <shopperEmailAddress>${email?xml}</shopperEmailAddress>
                </#if>
                <#if authenticatedShopperId??>
                <authenticatedShopperID>${authenticatedShopperId?xml}</authenticatedShopperID>
                </#if>
                <#if acceptHeader?? || userAgentHeader?? || browserLanguageTag??>
                <browser>
                    <#if acceptHeader??>
                    <acceptHeader>${acceptHeader?xml}</acceptHeader>
                    </#if>
                    <#if userAgentHeader??>
                    <userAgentHeader>${userAgentHeader?xml}</userAgentHeader>
                    </#if>
                    <#if browserLanguageTag??>
                    <browserLanguageTag>${browserLanguageTag?xml}</browserLanguageTag>
                    </#if>
                </browser>
                </#if>
            </shopper>
            </#if>
            <#if tokenEventReference??>
            <createToken tokenScope="shopper">
                <tokenEventReference>${tokenEventReference?xml}</tokenEventReference>
            </createToken>
            </#if>
            <#if is3dsFlexRequest()>
            <#if dfReferenceId??>
            <additional3DSData
                dfReferenceId="${dfReferenceId?xml}"
                challengeWindowSize="390x400" challengePreference="noPreference"
            />
            <#else>
            <additional3DSData
                dfReferenceId=""
                javaScriptEnabled="false"
                challengeWindowSize="390x400" challengePreference="noPreference"
            />
            </#if>
            </#if>
            <#if exemption??>
            <exemption type="${exemptionRequest.type?xml}" placement="${exemptionRequest.placement?xml}"/>
            </#if>
        </#if>
        </order>
    </submit>
</paymentService>
